!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("dsmStorybookNode",[],t):"object"==typeof exports?exports.dsmStorybookNode=t():e.dsmStorybookNode=t()}(global,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=119)}([,,function(e,t){e.exports=require("@babel/types")},function(e,t){e.exports=require("lodash/isEmpty")},function(e,t){e.exports={DSM_ADDON_NAME:"invision-dsm",DSM_INFO_OBJECT_KEY:"in-dsm",STORY_SELECTED_EVENT:"invision-dsm/on_story_selected",HTML_SAMPLE_CODE_CHANGED_EVENT:"invision-dsm/on_html_sample_code_changed",INIT_DSM_REGISTERED_EVENT:"invision-dsm/on_init_dsm_registered",INIT_DSM_EVENT:"invision-dsm/on_init_dsm",INJECTED_SOURCE_PLACEHOLDER:"__DSM_INJECTED_SOURCE__",KNOBS_SET_EVENT:"addon:knobs:setKnobs",KNOBS_SET_EVENT_V5_1:"storybookjs/knobs/set",STORY_CHANGED_EVENT:"storyChanged",STORYBOOK_ENV_VARIABLE:"STORYBOOK_DSM",WINDOW_MODES:{normal:"normal",fullscreen:"fullscreen"},WINDOW_MODE_PARAM:"mode",FRAMEWORKS:{html:"html",react:"react",angular:"angular",vue:"vue"}}},,function(e,t){e.exports=require("@babel/traverse")},function(e,t,n){const r=n(16);e.exports=function(e,t="javascript"){return function(e){if("javascript"===e)return r.parsers.babylon;throw new Error(`Parser unsupported: "${e}"`)}(t).parse(e)}},function(e,t){e.exports=require("prettier/standalone")},function(e,t){e.exports=require("lodash/get")},,function(e,t,n){const r=n(2),o=n(39);e.exports={getAvailableKnobsFunctions:function(e){const t=o(e,{moduleName:"@storybook/addon-knobs"});return t?t.bindings:[]},isKnownKnobMethodCall:function(e,t){return!(!r.isCallExpression(e)||!r.isIdentifier(e.callee))&&0!==e.arguments.length&&t.includes(e.callee.name)},extractKnobProperties:function(e){const t=e.arguments,n={knobLabel:t[0].value},r=function(e){switch(e){case"select":case"radios":case"files":case"optionsKnob":case"options":return 2;case"button":return null;default:return 1}}(e.callee.name);return r&&t.length>r&&(n.value=t[r].value),n}}},function(module,exports){function getChildrenString(e,t){return e.reduce((e,n)=>{return`${e}${hasValueSet(n,t)?getFieldValue(n,t):""}`},"")}function getFieldValue(e,t){return hasKnobValue(e,t)?t[e.knobLabel].value:e.value}function hasKnobValue(e,t){return!(!t||!e.knobLabel)&&(t.hasOwnProperty(e.knobLabel)&&hasValueSet(t[e.knobLabel]))}function hasValueSet(e,t){return e.hasOwnProperty("value")||t&&hasKnobValue(e,t)}function isDefaultValue(e,t){if(!e||!e.defaultValue)return!t;return getDefaultValueString(e.type.name,e.defaultValue.value)===JSON.stringify(t)}function getDefaultValueString(e,t){if(["object","array","objectOf","arrayOf"].includes(e)){const e=tryToEvalValue(t);if(e)return JSON.stringify(e)}return normalizeWrappingQuotes(t)}function tryToEvalValue(value){let defaultValueEval;try{defaultValueEval=eval(value)}catch(e){}return defaultValueEval}function normalizeWrappingQuotes(e){return e?e[0]!==e.slice(-1)?e:"'"===e[0]?`"${e.slice(1,-1)}"`:e:e}function getPropValueString(e){return"object"==typeof e?JSON.stringify(e).replace(/"/g,"'"):e.toString()}module.exports={getChildrenString:getChildrenString,getFieldValue:getFieldValue,getPropValueString:getPropValueString,hasValueSet:hasValueSet,isDefaultValue:isDefaultValue}},function(e,t){e.exports=require("prettier/parser-html")},function(e,t){e.exports=require("lodash")},,function(e,t){e.exports=require("prettier/parser-babylon")},function(e,t){e.exports=require("semver")},,,,function(e,t){class n extends Error{constructor(...e){super(...e),Error.captureStackTrace&&Error.captureStackTrace(this,n)}}e.exports={CustomError:n}},function(e,t,n){const r=n(6).default,o=n(2),a=n(7),s=n(9);function u(e,t){const n=function(e){const t=a(e);return function(e){if(!e)return!1;const t=s(e,"program.body[0]");return o.isExpressionStatement(t)&&(o.isJSXElement(t.expression)||o.isJSXFragment(t.expression))}(t)?t:null}(e);if(!n)return null;const u=function(e){const t=e.component;if(t)return e=>e===t;return e=>e[0]!==e[0].toLowerCase()&&"Fragment"!==e}(t);let i=null;return r(n,{JSXElement(e){const t=s(e,"node.openingElement.name.name");t&&u(t)&&(i=e.node,e.stop())}}),i}e.exports={getStorySubject:u,getComponentName:function(e,t){const n=u(e,t);return n?n.openingElement.name.name:null}}},function(e,t,n){"use strict";n.r(t),n.d(t,"getByVersion",function(){return a}),n.d(t,"resolvers",function(){return s});const{UnsupportedVersionError:r}=n(29),{versionResolvers:o}=n(30),a=(e,t)=>{const n=o[e](t);if(!n)throw new r(t);return n},s={getStoryUrlParams:"getStoryUrlParamsResolver",initDsmParams:"initDsmParamsResolver"}},function(e,t,n){const r={sampleCodeAnalyzers:{react:n(38),vue:n(40),angular:n(43),html:()=>{}},sampleCodeBuilders:{react:n(46),vue:n(47),angular:n(49),html:n(50)}},o=(e,t)=>{const n=t[e];if(!n)throw`Unsupported framework detected: ${e}`;return n};e.exports={getSampleCodeAnalyzer:e=>o(e,r.sampleCodeAnalyzers),getSampleCodeBuilder:e=>o(e,r.sampleCodeBuilders)}},,,,,function(e,t,n){const{CustomError:r}=n(21);e.exports={ModuleNotFoundError:class extends r{constructor(e,...t){super(...t),this.name="ModuleNotFoundError",this.message=`Could not load '${e}'. This module is required by dsm-storybook. \n    Please install a version of '${e}' that is compatible with the installed version of Storybook`}},UnsupportedVersionError:class extends r{constructor(e,...t){super(...t),this.name="UnsupportedVersionError",this.message=`Unsupported @Storybook version (${e}). \n    @invisionapp/dsm-storybook plugin does not support this version of Storybook.`}}}},function(e,t,n){const r={getStoryUrlParamsResolver:n(31),initDsmParamsResolver:n(35)};e.exports={versionResolvers:r}},function(e,t,n){const r=n(17),o=n(32),a=n(33);e.exports=function(e){return!e||r.satisfies(e,"^4.0.0")?o:r.satisfies(e,"^5.1.0-alpha.23")?a:void 0}},function(e,t){e.exports={getStoryUrlParams:(e,t)=>({selectedKind:e,selectedStory:t}),sanitizeParams:(e,t)=>({kind:e,name:t})}},function(e,t,n){const{sanitize:r}=n(34),o=(e,t)=>{return{kind:r(e),name:r(t)}};e.exports={getStoryUrlParams:(e,t)=>{const{kind:n,name:r}=o(e,t);return{path:`/story/${n}--${r}`}},sanitizeParams:o}},function(e,t){e.exports={sanitize:e=>e.toLowerCase().replace(/[ ’–—―′¿'`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,"-").replace(/-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),translateId:e=>{const t=e.split("--");return{kind:t[0],name:t[1]}}}},function(e,t,n){const r=n(17),o=n(36),a=n(37);e.exports=function(e){return!e||r.satisfies(e,"^4.0.0")?o:r.satisfies(e,"^5.1.1")?a:void 0}},function(e,t){e.exports=["addDecorator","callback"]},function(e,t){e.exports=["addDecorator","addParameters","callback"]},function(e,t,n){const r=n(2),{get:o}=n(14),{getStorySubject:a}=n(22),{INJECTED_SOURCE_PLACEHOLDER:s}=n(4),{getAvailableKnobsFunctions:u,isKnownKnobMethodCall:i,extractKnobProperties:l}=n(11);function c(e,t,n){return t.openingElement.attributes.map(t=>(function(e,t,n){if(r.isJSXSpreadAttribute(e))return{value:n.substring(e.start,e.end),isExpression:!0};const a=o(e,"name.name");let s=function(e,t,n){if(r.isStringLiteral(e))return{value:e.value};if(!r.isJSXExpressionContainer(e))return{};const o=e.expression;if(r.isIdentifier(o))return{value:o.name,isExpression:!0};if(i(o,t))return l(o);return{value:m(n,o.start,o.end),isExpression:!0}}(e.value,t,n);return{name:a,...s}})(t,n,e))}function f(e,t){const n=m(e,0,t.start),r=m(e,t.end);return`${n}${s}${r}`}function p(e,t,n){return 0===e.length?[]:e.map(e=>r.isJSXExpressionContainer(e)&&i(e.expression,n)?l(e.expression):{value:m(t,e.start,e.end)})}function m(e,t,n){return e.substring(t,n)}e.exports=function(e,t){try{const n=a(e.frameworkMetadata.returnStatement,e.dsmInfo);if(!n)return null;const r=u(e.importDeclarations),o=e.frameworkMetadata.returnStatement;return{componentName:n.openingElement.name.name,props:c(o,n,r),children:p(n.children,o,r),sourceTemplate:f(o,n)}}catch(n){return t&&t.error(`Failed to analyze sample code for story ${e?`${e.kind} - ${e.name}`:""} \n        ${n.stack}`),null}}},function(e,t){e.exports=require("lodash/find")},function(e,t,n){const r=n(2),o=n(6).default,{getStorySubject:a,vueTemplateCompilerTypes:s}=n(41),{INJECTED_SOURCE_PLACEHOLDER:u}=n(4),{getAvailableKnobsFunctions:i,isKnownKnobMethodCall:l,extractKnobProperties:c}=n(11),f=n(7),p="let dummyObject =";function m(e,t){const{attrsList:n,attrsMap:r}=e,o={},a=n.map(e=>(o[e.name]=!0,g(e,t)));return Object.keys(r).forEach(e=>{if(!o[e])if(""===r[e])a.push({name:e});else{const n={name:e,value:r[e]};a.push(g(n,t))}}),a}function d(e,t){return t.find(t=>t.storyPropName===e)}function g(e,t){if(!(e.name.startsWith(":")||e.name.startsWith("v-bind:")))return{name:e.name,value:e.value};const n=d(e.value,t);if(n){return{name:e.name.split(":")[1],value:n.value,knobLabel:n.knobLabel}}return{name:e.name,value:e.value}}function b(e,t){const n=E(e,0,t.start),r=E(e,t.end);return`${n}${u}${r}`}function S(e,t,n){if(0===e.length)return[];const r=[];return e.forEach(e=>{if(e.type!==s.expression||0===e.tokens.length)r.push({value:E(t,e.start,e.end)});else{e.tokens.forEach(e=>{const t=e["@binding"];if(t){const e=d(t,n);e?r.push({value:e.value,knobLabel:e.knobLabel}):r.push({value:`{{${t}}}`})}else r.push({value:`${e}`})})}}),r}function E(e,t,n){return e.substring(t,n)}e.exports=function(e,t){try{if(!e.frameworkMetadata||!e.frameworkMetadata.storyTemplate)return null;e.frameworkMetadata.storyTemplate=e.frameworkMetadata.storyTemplate.trim();const n=e.frameworkMetadata.storyTemplate,s=a(n,e.dsmInfo);if(!s)return null;const u=i(e.importDeclarations),d=function(e,t){if(!e)return[];const n=[],a=f(p+e);return o(a,{ObjectProperty(e){const o=e.node,a=function(e){if(!e.value||!r.isObjectExpression(e.value))return;const t=(n=e.value.properties,o="default",n.find(e=>e.key.name===o));var n,o;return t&&t.value}(o);if(a&&r.isCallExpression(a)&&l(a,t)){const e=c(a);n.push(Object.assign({storyPropName:o.key.name},e))}}}),n}(e.frameworkMetadata.storyLevelProps,u);return{componentName:s.tag,props:m(s,d),children:S(s.children,n,d),sourceTemplate:b(n,s)}}catch(n){return t&&t.error(`Failed to analyze sample code for story ${e?`${e.kind} - ${e.name}`:""}\n        ${n.stack}`),null}}},function(e,t,n){const r=n(42),o={component:1,expression:2,string:3};function a(e,t){const n=function(e){return r.compile(e,{outputSourceRange:!0}).ast}(e);if(!n)return null;let a=n;const s=t.component;return s&&a.tag!==s&&(a=function e(t,n){if(t.type===o.component){if(t.tag===n)return t;let r;for(let o of t.children)if(r=e(o,n))break;return r}}(a,s)),a}e.exports={getStorySubject:a,getComponentTagName:function(e,t){const n=a(e,t);return n?n.tag:null},vueTemplateCompilerTypes:o}},function(e,t){e.exports=require("vue-template-compiler")},function(e,t,n){const r=n(14),o=n(2),a=n(6).default,{getStorySubject:s}=n(44),{INJECTED_SOURCE_PLACEHOLDER:u}=n(4),{getAvailableKnobsFunctions:i,isKnownKnobMethodCall:l,extractKnobProperties:c}=n(11),f=n(7),p="let dummyObject =";function m(e,t){const{attributes:n,inputs:o,outputs:a}=e,s=n.map(e=>e.valueSpan?{name:e.name,value:e.value}:{name:e.name});return o.forEach(e=>{s.push(function(e,t){const n=r.get(e,"value.source");if("BoundAttribute"!==b(e))return{name:e.name,value:n};const o=d(n,t);return o?{name:e.name,value:o.value,knobLabel:o.knobLabel}:{name:`[${e.name}]`,value:n}}(e,t))}),a.forEach(e=>{s.push({name:`(${e.name})`,value:e.handler.source})}),s}function d(e,t){return t.find(t=>t.storyPropName===e)}function g(e,t){const n=E(e,0,t.sourceSpan.start.offset),r=E(e,t.endSourceSpan.end.offset);return`${n}${u}${r}`}function b(e){return e.constructor&&e.constructor.name}function S(e,t,n){if(0===e.length)return[];const o=[];return e.forEach(e=>{const a=r.get(e,"sourceSpan");if(!a)return;const s=b(e);if("Element"!==s){if("BoundText"===s){const t=function(e,t){const n=r.get(e,"value.ast.expressions");if(n&&1===n.length&&"PropertyRead"===b(n[0])){const e=n[0].name,r=d(e,t);if(r)return{value:r.value,knobLabel:r.knobLabel}}}(e,n);if(t)return void o.push(t)}o.push({value:E(t,a.start.offset,a.end.offset)})}else{const n=e.startSourceSpan.start.offset,a=r.get(e,"endSourceSpan.end.offset")||e.startSourceSpan.end.offset;o.push({value:E(t,n,a)})}}),o}function E(e,t,n){return e.substring(t,n)}e.exports=function(e,t){try{const n=e.frameworkMetadata&&e.frameworkMetadata.storyTemplate;if(!n)return null;const r=s(n,e.dsmInfo);if(!r)return null;const u=i(e.importDeclarations),d=function(e,t){if(!e)return[];const n=[],r=f(p+e);return a(r,{ObjectProperty(e){const r=e.node,a=r.value;if(a&&o.isCallExpression(a)&&l(a,t)){const e=c(a);n.push(Object.assign({storyPropName:r.key.name},e))}}}),n}(e.frameworkMetadata.storyLevelProps,u);return{componentName:r.name,props:m(r,d),children:S(r.children,n,d),sourceTemplate:g(n,r)}}catch(n){return t&&t.error(`Failed to analyze sample code for story ${e?`${e.kind} - ${e.name}`:""}\n        ${n.stack}`),null}}},function(e,t,n){const r=n(45),{parseTemplate:o}=r;function a(e,t){const n=t.component,r=function(e){return o(e,"",{},"")}(e);if(!r||!r.nodes||0===r.nodes.length)return null;const a=1===r.nodes.length;let s;if(!n&&!a)throw"Template contains multiple root elements; component name must be provided as `component` option in in-dsm object";return s=a?r.nodes[0]:{name:"____fake-root____",children:r.nodes},n&&s.name!==n&&(s=function e(t,n){if(t.name){if(t.name===n)return t;let r;for(let o of t.children)if(r=e(o,n))break;return r}}(s,n)),s}e.exports={getStorySubject:a,getComponentTagName:function(e,t){const n=a(e,t);return n?n.name:null}}},function(e,t){e.exports=require("@angular/compiler")},function(e,t,n){const r=n(8),o=[n(16)],a=n(3),{INJECTED_SOURCE_PLACEHOLDER:s}=n(4),{getChildrenString:u,getFieldValue:i,getPropValueString:l,hasValueSet:c,isDefaultValue:f}=n(12);e.exports=function(e,t={},n={},p){if(a(e))return"";const m=`<${e.componentName}`,d=function(e,t,n){if(!e||0===e.length)return"";return e.reduce((e,r)=>`${e} ${function(e,t,n){if(!c(e,n))return"";const r=i(e,n);if(f(t,r))return"";if("boolean"==typeof r&&r)return`${e.name}`;const o=!e.isExpression&&"string"==typeof r,a=o?'"':"{",s=o?'"':"}";return e.name?`${e.name}=${a}${l(r)}${s} `:l(r)}(r,t[r.name],n)}`,"")}(e.props,n,p),g=u(e.children,p),b=`${m} ${d} ${g?">":"/>"}${g}${g?`</${e.componentName}>`:""}`,S=e.sourceTemplate.replace(s,b),E=Object.assign({},{parser:"babel",plugins:o},t);try{return r.format(S,E)}catch(e){return e.message}}},function(e,t,n){const r=n(8),o=[n(13)],a=n(3),s=n(48),{INJECTED_SOURCE_PLACEHOLDER:u}=n(4),{getChildrenString:i,getFieldValue:l,getPropValueString:c,hasValueSet:f,isDefaultValue:p}=n(12);e.exports=function(e,t={},n={},m){if(a(e))return"";const d=`<${e.componentName}`,g=function(e,t,n){if(!e||0===e.length)return"";return e.reduce((e,r)=>`${e} ${function(e,t,n){if(!f(e,n))return e.name+" ";const r=l(e,n);if(p(t,r))return"";return`${e.name}="${c(r)}" `}(r,t[r.name],n)}`,"")}(e.props,n,m),b=i(e.children,m),S=`</${e.componentName}>`,E=`${d}${s(g)}>${b}${S}`,h=e.sourceTemplate.replace(u,E),y=Object.assign({},{parser:"vue",plugins:o},t);try{return r.format(h,y)}catch(e){return e.message}}},function(e,t){e.exports=require("lodash/trimEnd")},function(e,t,n){const r=n(8),o=[n(13)],a=n(3),{INJECTED_SOURCE_PLACEHOLDER:s}=n(4),{getChildrenString:u,getFieldValue:i,hasValueSet:l,isDefaultValue:c,getPropValueString:f}=n(12);e.exports=function(e,t={},n={},p){if(a(e))return"";const m=`${`<${e.componentName}`}${function(e,t,n){if(!e||0===e.length)return"";return e.reduce((e,r)=>`${e} ${function(e,t,n){if(!l(e,n))return e.name+" ";const r=i(e,n);if(c(t,r))return"";return`${e.name}="${f(r)}" `}(r,t[r.name],n)}`,"")}(e.props,n,p)}>${u(e.children,p)}${`</${e.componentName}>`}`,d=e.sourceTemplate.replace(s,m),g=Object.assign({},{parser:"angular",plugins:o},t);try{return r.format(d,g)}catch(e){return e.message}}},function(e,t,n){const r=n(8),o=[n(13)],a=n(3);e.exports=function({sampleCode:e},t={},n={},s){if(a(e))return"";const u=Object.assign({},{parser:"html",plugins:o},t);try{return r.format(e,u)}catch(e){return e.message}}},function(e,t){e.exports=function(e){const t=[];return e.forEach(e=>{e.stories.forEach(n=>{t.push({importDeclarations:[...e.importDeclarations],...n})})}),t}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){t.getSampleCodeAnalyzer=n(24).getSampleCodeAnalyzer,t.getSampleCodeBuilder=n(24).getSampleCodeBuilder,t.mapStoryFilesToStories=n(51),t.getStoryUrlParams=n(120)},function(e,t,n){const{getByVersion:r,resolvers:o}=n(23);e.exports=function(e,t,n){const{getStoryUrlParams:a}=r(o.getStoryUrlParams,n);return a(e,t)}}])});